with
CTE_DATA_INSS
AS(
    Select 
        REPLACE(REPLACE(CONCAT(NOMBRE1,SPACE(1),NOMBRE2,SPACE(1),APELLIDO1,SPACE(1),APELLIDO2),'NULL',''),'  ',' ') COLLATE DATABASE_DEFAULT AS NOMBRE,
        REPLACE(UPPER(CEDULA),'-','') COLLATE DATABASE_DEFAULT AS CEDULA,
        SALARIO AS SALARIOINSS,
        DOMICILIO_ASE COLLATE DATABASE_DEFAULT AS DOMICILIO
    from BasesRecibidas.dbo.db_inss_29062019_1
),
CTE_SUMARIZE
AS(
    SELECT 
        NOMBRE,
        CEDULA,
        SUM(SALARIOINSS) AS SALARIOINSS,
        DOMICILIO
    FROM CTE_DATA_INSS
    GROUP BY NOMBRE,CEDULA,DOMICILIO
),
CTE_JOIN_BDC
AS(
    SELECT 
        B.*,
        A.NOMBRE AS NEWNOMBRE,
        A.DOMICILIO AS NEWDOMICILIO,
        A.SALARIOINSS AS NEWSALARIO,
        A.CEDULA AS CEDULA2
    FROM CTE_SUMARIZE A
    LEFT JOIN BaseControl.dbo.Persona B ON A.CEDULA = B.Cedula
)
-- ,
-- CTE_PERSONA_NUEVA
-- AS (
--     SELECT 
--         NEWNOMBRE NOMBRE,
--         NEWSALARIO SALARIO,
--         NEWDOMICILIO DOMICILIO,
--         CEDULA2 CEDULA    
--     FROM CTE_JOIN_BDC WHERE CEDULA IS NULL
-- )
-- select * 
-- from CTE_JOIN_BDC
-- where CEDULA2 is not NULL

-- UPDATE BaseControl.dbo.Persona
-- SET Domicilio = B.NEWDOMICILIO,
--     SALARIOINSS = B.NEWSALARIO,
--     Nombre = B.NEWNOMBRE
-- FROM BaseControl.dbo.Persona A
-- INNER JOIN CTE_JOIN_BDC B ON A.IdPersona = B.IdPersona

SELECT 
TOP 1000
    NOMBRE,NEWNOMBRE,
    Domicilio,NEWDOMICILIO,
    SalarioInss,NEWSALARIO
FROM CTE_JOIN_BDC
WHERE CEDULA IS NOT NULL